<?xml version="1.0" encoding="utf-8"?>
<sql-descriptor id="bp/tcams/common/PKMS" data-source="tcamsDS">

 <sql id="select" comment="조회">
  <![CDATA[
WITH T1 (
  PKMS_CORP_CODE
 ,PKMS_COME_CODE
 ,PKMS_TABL_ID
 ,PKMS_SORT_NUMB
 ,PKMS_TABL_NAME
 ,PKMS_UPDT_DATE
 ,PKMS_UPDT_CMAN
 ,PKMS_INIT_DATE
 ,PKMS_INIT_CMAN
) AS (
@sql_str@ 
), T2 (SEQ, C1) AS (
       SELECT  1, 'CRTBCMCT' FROM DUAL 
 UNION SELECT  2, 'CRTBTRPT' FROM DUAL
 UNION SELECT  3, 'CWTBEXRA' FROM DUAL
 UNION SELECT  4, 'CWTBPROJ' FROM DUAL
 UNION SELECT  5, 'ESAAPRO'  FROM DUAL       
 UNION SELECT  6, 'ESAAUFU'  FROM DUAL
 UNION SELECT  7, 'ESAAUML'  FROM DUAL
 UNION SELECT  8, 'ESAAUMM'  FROM DUAL
 UNION SELECT  9, 'ESAAUMU'  FROM DUAL
 UNION SELECT 10, 'ESAAURM'  FROM DUAL
 UNION SELECT 11, 'ESAAURP'  FROM DUAL
 UNION SELECT 12, 'ESACCDL'  FROM DUAL
 UNION SELECT 13, 'ESACDDT'  FROM DUAL
 UNION SELECT 14, 'ESAJBTP'  FROM DUAL
 UNION SELECT 15, 'ESAJOBM'  FROM DUAL
 UNION SELECT 16, 'ESAJOBU'  FROM DUAL
 UNION SELECT 17, 'ESALANG'  FROM DUAL
 UNION SELECT 18, 'CATBINPT' FROM DUAL
 UNION SELECT 19, 'CITBPKCL' FROM DUAL
)
SELECT CASE WHEN B.TABLE_NAME IS NOT NULL THEN 'Y' ELSE 'N' END CREATED_YN
      ,CASE WHEN C.COMMENTS IS NULL THEN 'N' WHEN C.COMMENTS <> A.PKMS_TABL_NAME THEN 'E' ELSE 'Y' END DESC_YN
	  ,(SELECT COUNT(*) FROM USER_TAB_COLUMNS WHERE TABLE_NAME = A.PKMS_TABL_ID) CNT_COL
	  ,(SELECT COUNT(*) FROM USER_COL_COMMENTS WHERE TABLE_NAME = A.PKMS_TABL_ID AND COMMENTS IS NOT NULL AND SUBSTRING(COMMENTS,1,1) <> '.') CNT_COL_DESC
	  ,CASE WHEN D.SEQ IS NOT NULL THEN 'Y' ELSE 'N' END MGT_YN
	  ,A.PKMS_CORP_CODE COMD_CORP_CODE
	  ,A.PKMS_COME_CODE COMD_COME_CODE
	  ,A.PKMS_TABL_ID   COMD_TABL_ID  
	  ,A.PKMS_SORT_NUMB COMD_SORT_NUMB
	  ,COALESCE(C.COMMENTS, 'TBD') COMD_TABL_NAME
	  ,A.PKMS_UPDT_DATE COMD_UPDT_DATE
	  ,A.PKMS_UPDT_CMAN COMD_UPDT_CMAN
	  ,A.PKMS_INIT_DATE COMD_INIT_DATE
	  ,A.PKMS_INIT_CMAN COMD_INIT_CMAN
	  ,'SYSTEMPG'       COMD_INIT_NAME
	  ,A.PKMS_TABL_NAME CMT
      ,A.*
  FROM T1 A
      LEFT OUTER JOIN 
       USER_TABLES B
      ON B.TABLE_NAME = A.PKMS_TABL_ID
      LEFT OUTER JOIN 
       USER_TAB_COMMENTS C
      ON C.TABLE_NAME = A.PKMS_TABL_ID
      LEFT OUTER JOIN
       T2 D
      ON D.C1 = A.PKMS_TABL_ID
 WHERE A.PKMS_COME_CODE = UPPER(#pkms_come_code#) 
   AND A.PKMS_TABL_ID LIKE '%' || NVL(#pkms_tabl_id#, A.PKMS_TABL_ID) || '%' 
 ORDER BY A.PKMS_SORT_NUMB  
  ]]>
 </sql>

 <sql id="PKMS.CW" comment="CW">
  <![CDATA[
WITH T1 (
 C1
,C2
) AS (  
          SELECT 'CWTBPROJ','프로젝트 관리' FROM DUAL
UNION ALL SELECT 'CWTBATCO','프로젝트 상세_원자재단가' FROM DUAL
UNION ALL SELECT 'CWTBEXRA','프로젝트 상세_환율기준' FROM DUAL
UNION ALL SELECT 'CWTBPREX','원단위상세 구성모델' FROM DUAL
UNION ALL SELECT 'CWTBWGAB','원단위 갑지 (종합)' FROM DUAL
UNION ALL SELECT 'CWTBWONB','원단위 구성 (TEMP)' FROM DUAL
UNION ALL SELECT 'CWTBWONC','원단위 구성 (TEMP)' FROM DUAL
UNION ALL SELECT 'CWTBWONM','원단위 구성' FROM DUAL
UNION ALL SELECT 'CWTBWONP','원단위 구성 (TEMP)' FROM DUAL
UNION ALL SELECT 'CWTBWONT','원단위 구성 (TEMP)' FROM DUAL
UNION ALL SELECT 'CWTBWONU','원단위 구성 (BOM정보수신)' FROM DUAL
UNION ALL SELECT 'CWTBLNKE','변동전-후 품목정보' FROM DUAL
UNION ALL SELECT 'CWTBLNDM','변동원가 재료적용일' FROM DUAL
UNION ALL SELECT 'CWTBLNDP','변동원가 공통율적용일' FROM DUAL
UNION ALL SELECT 'CWTBUPLD','원단위 UPLOAD' FROM DUAL
)
SELECT * FROM T1 
  ]]>
 </sql>

 <sql id="COLS">
  <![CDATA[
WITH GRPS (
   GRP_TEXT
  ,GRP_WIDTH
  ,DATA_FIELD
) AS (
           SELECT 'GRP1', 400, 'gx_colxx' FROM DUAL
), COLS (
  SEQ
 ,DATA_FIELD
 ,HEADER_TYPE
 ,HEADER_TEXT
 ,WIDTH
 ,TEXT_ALIGN
 ,EDITABLE
 ,DATA_TYPE
 ,FORMAT_TYPE
 ,ITEM_EDITOR
 ,MERGEABLE
) AS (
           SELECT  1 ,'crt_date' ,'C'  ,'시간'       ,200 ,'center'  ,'false' ,'text' ,'text' ,'' ,'false' FROM DUAL
 UNION ALL SELECT  2 ,'code'     ,'C'  ,'코드'       ,100 ,'center'  ,'false' ,'text' ,'text' ,'' ,'false' FROM DUAL
 UNION ALL SELECT  3 ,'message'  ,'C'  ,'메세지'      ,800 ,'left'    ,'false' ,'text' ,'text' ,'' ,'false' FROM DUAL
)
SELECT A.*, B.GRP_TEXT, B.GRP_WIDTH
  FROM COLS A
      LEFT OUTER JOIN
       GRPS B
      ON B.DATA_FIELD = A.DATA_FIELD
 ORDER BY SEQ
  ]]>
 </sql>	

 <sql id="id" comment="comment">
  <![CDATA[
  ]]>
 </sql>
  
</sql-descriptor> 